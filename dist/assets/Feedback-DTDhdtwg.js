import{r as o,j as e}from"./react-LlGSwrXN.js";import{p as F,B as y}from"./index-C5d6JHCt.js";import"./tanstack-BEt7DztD.js";import"./redux-BBHHYmT8.js";import"./vendor-DrTQk38K.js";async function R(r){const i=await F("/api/contact",r);if(i==null)return{status:"ok",id:""};if(typeof i=="string"){const n=i.trim().toLowerCase();if(n===""||n==="ok"||n==="success")return{status:"ok",id:""}}const t=typeof i=="object"&&i!==null?i:{};return t.ok===!0?{status:"ok",id:typeof t.id=="string"?t.id:""}:t.status==="ok"?{status:"ok",id:typeof t.id=="string"?t.id:""}:{status:"error",message:typeof t.message=="string"?t.message:"Unexpected response from server."}}function M(r){return r.status==="ok"}function E(r){return r.status==="error"}function P(r){return!!r&&/\S+@\S+\.\S+/.test(r)}const l=500;function U(){const[r,i]=o.useState({name:"",email:"",category:"",message:"",consent:!1,website:""}),[t,m]=o.useState({}),[n,p]=o.useState(!1),[v,c]=o.useState(""),[j,u]=o.useState(!1),f=o.useRef(null),b=o.useRef(null),x=o.useRef(null),g=o.useRef(null),h=o.useRef(null),k=s=>{const a={};return s.category||(a.category="Please choose a category."),s.message.trim()||(a.message="Please describe your feedback."),s.message.length>l&&(a.message=`Please keep your message within ${l} characters.`),s.email&&!P(s.email)&&(a.email="Please provide a valid email."),s.consent||(a.consent="Please confirm you agree to our privacy notice."),s.website.trim()&&(a.website="Spam detected."),a},w=s=>{if(s.category&&x.current)return x.current.focus();if(s.message&&g.current)return g.current.focus();if(s.email&&b.current)return b.current.focus();if(s.consent&&h.current)return h.current.focus();f.current&&f.current.focus()},N=async s=>{s.preventDefault(),c("");const a=k(r);if(m(a),Object.keys(a).length>0){w(a);return}p(!0),c("Sending feedback…");try{const C={name:r.name||void 0,email:r.email||void 0,category:r.category,message:r.message.slice(0,l),agree:r.consent,meta:{source:"web",page:window.location?.pathname??"/feedback"}},d=await R(C);M(d)?(u(!0),c("Thanks! Your feedback has been received."),i({name:"",email:"",category:"",message:"",consent:!1,website:""})):E(d)?c(d.message||"Something went wrong. Please try again."):(console.warn("Unhandled response shape",d),c("Unexpected response from server."))}catch{c("Network error. Please try again.")}finally{p(!1)}},S=s=>{i(a=>({...a,message:s.slice(0,l)})),t.message&&s.length<=l&&m(a=>({...a,message:void 0}))};return e.jsxs("main",{className:"mx-auto max-w-3xl px-4 py-12",children:[e.jsxs("header",{children:[e.jsx("h1",{className:"text-3xl lg:text-4xl font-extrabold text-ink",children:"Send Feedback"}),e.jsx("p",{className:"mt-3 text-ink-soft",children:"We value your input. Tell us what works well and what could be improved."})]}),e.jsx("p",{"aria-live":"polite",className:"sr-only",children:v}),e.jsxs("form",{className:"mt-8 space-y-6",onSubmit:N,noValidate:!0,children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"fb-name",className:"block text-sm font-medium text-ink",children:"Name (optional)"}),e.jsx("input",{id:"fb-name",ref:f,type:"text",autoComplete:"name",value:r.name,onChange:s=>i(a=>({...a,name:s.target.value})),className:"mt-2 h-11 w-full rounded-full border border-border px-4 outline-none focus-visible:ring-2 focus-visible:ring-primary/40",placeholder:"Your name",disabled:n})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"fb-email",className:"block text-sm font-medium text-ink",children:"Email (optional)"}),e.jsx("input",{id:"fb-email",ref:b,type:"email",inputMode:"email",autoComplete:"email",value:r.email,onChange:s=>i(a=>({...a,email:s.target.value})),"aria-invalid":!!t.email||void 0,"aria-describedby":t.email?"fb-email-err":void 0,className:"mt-2 h-11 w-full rounded-full border border-border px-4 outline-none focus-visible:ring-2 focus-visible:ring-primary/40",placeholder:"you@example.com",disabled:n}),t.email&&e.jsx("p",{id:"fb-email-err",className:"mt-2 text-sm text-red-600",children:t.email})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"fb-category",className:"block text-sm font-medium text-ink",children:"Category *"}),e.jsxs("select",{id:"fb-category",ref:x,value:r.category,onChange:s=>i(a=>({...a,category:s.target.value})),"aria-invalid":!!t.category||void 0,"aria-describedby":t.category?"fb-category-err":void 0,className:"mt-2 h-11 w-full rounded-full border border-border px-4 outline-none bg-white focus-visible:ring-2 focus-visible:ring-primary/40",disabled:n,children:[e.jsx("option",{value:"",children:"Select a category…"}),e.jsx("option",{value:"Bug",children:"Bug"}),e.jsx("option",{value:"Feature request",children:"Feature request"}),e.jsx("option",{value:"Idea",children:"Idea"}),e.jsx("option",{value:"Other",children:"Other"})]}),t.category&&e.jsx("p",{id:"fb-category-err",className:"mt-2 text-sm text-red-600",children:t.category})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{htmlFor:"fb-message",className:"block text-sm font-medium text-ink",children:"Message *"}),e.jsxs("span",{className:"text-xs text-ink-soft",children:[r.message.length,"/",l]})]}),e.jsx("textarea",{id:"fb-message",ref:g,value:r.message,onChange:s=>S(s.target.value),maxLength:l,"aria-invalid":!!t.message||void 0,"aria-describedby":t.message?"fb-message-err":"fb-message-hint",className:"mt-2 min-h-[140px] w-full rounded-2xl border border-border p-4 outline-none focus-visible:ring-2 focus-visible:ring-primary/40",placeholder:"Describe the issue or your idea…",disabled:n}),e.jsxs("p",{id:"fb-message-hint",className:"mt-1 text-xs text-ink-soft",children:["Up to ",l," characters."]}),t.message&&e.jsx("p",{id:"fb-message-err",className:"mt-2 text-sm text-red-600",children:t.message})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("input",{id:"fb-consent",ref:h,type:"checkbox",checked:r.consent,onChange:s=>i(a=>({...a,consent:s.target.checked})),"aria-invalid":!!t.consent||void 0,"aria-describedby":t.consent?"fb-consent-err":void 0,className:"mt-1 h-5 w-5 rounded border-border text-primary focus-visible:ring-2 focus-visible:ring-primary/40",disabled:n}),e.jsx("label",{htmlFor:"fb-consent",className:"text-sm text-ink",children:"I agree that my feedback may be stored and processed to improve the product."})]}),t.consent&&e.jsx("p",{id:"fb-consent-err",className:"text-sm text-red-600",children:t.consent}),e.jsxs("div",{"aria-hidden":"true",className:"hidden",children:[e.jsx("label",{htmlFor:"fb-website",children:"Website"}),e.jsx("input",{id:"fb-website",type:"text",value:r.website,onChange:s=>i(a=>({...a,website:s.target.value})),tabIndex:-1,autoComplete:"off"})]}),e.jsx("div",{className:"pt-2",children:e.jsx(y,{size:"lg",variant:"primary",loading:n,disabled:n,type:"submit",children:n?"Sending…":"Submit feedback"})})]}),j&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",onClick:()=>u(!1),role:"dialog","aria-modal":"true","aria-labelledby":"success-modal-title",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-xl max-w-md w-full p-6 animate-in fade-in zoom-in duration-200",onClick:s=>s.stopPropagation(),children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsx("h2",{id:"success-modal-title",className:"text-2xl font-bold text-ink mb-2",children:"Submission Successful!"}),e.jsx("p",{className:"text-ink-soft mb-6",children:"Thank you for your feedback. We have received your message."}),e.jsx(y,{variant:"primary",onClick:()=>u(!1),className:"w-full",children:"OK"})]})})})]})}export{U as default};
